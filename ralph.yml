cli:
  backend: "claude"

event_loop:
  completion_promise: "LOOP_COMPLETE"
  max_iterations: 50
  prompt_file: "PROMPT.md"
  starting_event: "work.start"
  checkpoint_interval: 1

core:
  scratchpad: ".agent/scratchpad.md"
  specs_dir: "./specs/"

hats:
  git_setup:
    name: "Git Setup"
    description: |
      Git状態確認。変更があればコミット・プッシュ。

      実行手順:
      1. gh auth status (認証確認)
      2. git status で状態確認
      3. 変更があれば git add -A && git commit && git push

      完了後: git.ready を発行
    triggers:
      - "work.start"
    publishes:
      - "git.ready"
      - "LOOP_COMPLETE"

  planner:
    name: "Planner"
    description: |
      Phase 2 タスク計画。

      目標:
      1. Cloudflare Workers AI でASR/LLM統合
      2. TTS統合（Workers AI or 外部）
      3. 日本語形態素解析（kuromoji-wasm）
      4. Service Worker オフラインキャッシュ
      5. PWAアイコン生成
      6. デプロイ準備

      成果物:
      - specs/phase2-plan.md に実装計画
      - 優先順位と依存関係を明確化

      完了後:
      1. .agent/iteration.log に記録
      2. git add -A && git commit && git push
    triggers:
      - "git.ready"
    publishes:
      - "plan.ready.ai"
      - "plan.ready.pwa"

  ai_integrator:
    name: "AI Integrator"
    description: |
      Cloudflare Workers AI 統合。

      実装対象:
      1. ASR: @cf/openai/whisper で音声→テキスト
      2. LLM: @cf/meta/llama-3.1-8b-instruct でウサギ応答生成
         - 3歳向け安全なシステムプロンプト設計
         - 日本語対応
      3. TTS: Workers AI (利用可能な場合) or 外部API
      4. 形態素解析: kuromoji-wasm で語彙抽出精度向上

      src/index.ts の該当箇所を更新:
      - mockASR → Whisper API呼び出し
      - mockLLM → Llama API呼び出し
      - mockTTS → 実際のTTS生成
      - tokenizeJaLoose → kuromoji

      完了後:
      1. .agent/iteration.log に記録
      2. git add -A && git commit && git push
    triggers:
      - "plan.ready.ai"
      - "review.ai.changes"
    publishes:
      - "ai.done"

  pwa_enhancer:
    name: "PWA Enhancer"
    description: |
      PWA機能強化。

      実装対象:
      1. Service Worker キャッシュ戦略
         - 静的アセット（HTML/CSS/JS）のキャッシュ
         - TTSオーディオのキャッシュ
         - オフラインフォールバック
      2. PWAアイコン生成
         - 192x192, 512x512
         - マスカブルアイコン
         - manifest.webmanifest 更新
      3. インストールプロンプト
      4. オフライン対応UI

      完了後:
      1. .agent/iteration.log に記録
      2. git add -A && git commit && git push
    triggers:
      - "plan.ready.pwa"
      - "review.pwa.changes"
    publishes:
      - "pwa.done"

  deployer:
    name: "Deployer"
    description: |
      デプロイ準備と検証。

      確認項目:
      - TypeScriptコンパイル
      - wrangler.jsonc 設定確認
      - D1マイグレーション手順確認
      - 環境変数/シークレット一覧
      - wrangler dev でローカル動作確認

      成果物:
      - DEPLOY_GUIDE.md（デプロイ手順書）

      問題発見時:
      - AI問題 → review.ai.changes
      - PWA問題 → review.pwa.changes

      完了後:
      1. .agent/iteration.log に記録
      2. git add -A && git commit && git push

      LOOP_COMPLETE発行時は追加で:
      3. COMPLETION_REPORT.md を更新
      4. 最終 git push
    triggers:
      - "ai.done"
      - "pwa.done"
    publishes:
      - "review.ai.changes"
      - "review.pwa.changes"
      - "LOOP_COMPLETE"
